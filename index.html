<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscador de Países</title>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>

  <style>
    /* 
      Loader: círculo girando mientras espera la API 
    */
    .loader {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #007bff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Estilo de cada tarjeta de país (cuando se listan por región) */
    .country-card {
      border-radius: 15px;
      background-color: #ffffff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

    /* Efecto hover de la tarjeta */
    .country-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    }

    /* Bandera */
    .country-flag {
      width: 100%;
      height: 150px;
      object-fit: cover;   /* que no se estire feo */
      border-bottom: 1px solid #eee;
    }

    /* Info dentro de la tarjeta */
    .country-info {
      padding: 12px;
      text-align: left;
    }

    .country-name {
      color: #007bff;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 6px;
    }

    .country-detail {
      font-size: 0.9rem;
      color: #333;
    }
  </style>
</head>

<body class="bg-light text-center">

  <!-- CONTENEDOR PRINCIPAL -->
  <div class="container py-4">
    <h1 class="my-4 text-primary">Buscador de Países (Inglés)</h1>

    <!-- BARRA DE BÚSQUEDA (Texto + Botón + Región) -->
    <div id="searchContainer" class="row g-3 justify-content-center align-items-center mb-4">

      <!-- Input donde el usuario escribe el país -->
      <div class="col-12 col-sm-6 col-md-4 col-lg-3">
        <input type="text" id="paisInput" placeholder="Escribe un país" class="form-control">
      </div>

      <!-- Botón para buscar país por nombre -->
      <div class="col-12 col-sm-6 col-md-3 col-lg-2">
        <button class="btn btn-primary w-100" onclick="buscarPais()">Buscar</button>
      </div>

      <!-- Selector de regiones  -->
      <div class="col-12 col-sm-6 col-md-4 col-lg-3">
        <select id="conti" class="form-select" onchange="buscarPorRegion()">
          <option value="">Selecciona una región</option>
          <option value="Americas">Americas</option>
          <option value="Europe">Europe</option>
          <option value="Asia">Asia</option>
          <option value="Oceania">Oceania</option>
          <option value="Africa">Africa</option>
        </select>
      </div>
    </div>

    <h2><a href="juego.html">juego</a></h2>

    <!-- Aquí se muestran resultados, tarjetas y mapa -->
    <div id="resultado" class="row justify-content-center g-4"></div>
  </div>

  <!-- Script principal de Leaflet (para el mapa) -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>


  <script>

    /*   FUNCIÓN: Buscar país por nombre*/
    function buscarPais() {

      // Leo lo que escribió el usuario
      const pais = document.getElementById('paisInput').value.trim().toLowerCase();

      // Si está vacío  salgo
      if (!pais) return;

      // URL para la API
      const url = `https://restcountries.com/v3.1/name/${pais}`;

      const resultado = document.getElementById('resultado');

      // Pongo animación de carga
      resultado.innerHTML = '<div class="loader"></div>';

      // Llamada a la API
      fetch(url)
        .then(res => {
          // Si la API devuelve error 404 
          if (!res.ok) throw new Error("País no encontrado");
          return res.json();
        })
        .then(data => {
          // data[0] → primer país encontrado
          mostrarPaisYLimitrofes(data[0]);
        })
        .catch(error => {
          resultado.innerHTML =
            `<p class="text-danger fw-bold">Error: ${error.message}</p>`;
        });
    }



    /*  FUNCIÓN: Buscar países por región
       */
    function buscarPorRegion() {

      const region = document.getElementById('conti').value;
      const resultado = document.getElementById('resultado');

      if (!region) return;

      // Loader
      resultado.innerHTML = '<div class="loader"></div>';

      // API de regiones
      fetch(`https://restcountries.com/v3.1/region/${region}`)
        .then(res => res.json())
        .then(data => {

          // Limpio pantalla
          resultado.innerHTML = '';

          // Recorro cada país
          data.forEach(pais => {

            const div = document.createElement('div');
            div.classList.add('col-12', 'col-sm-6', 'col-md-4', 'col-lg-3');

            // Card simple con datos básicos
            div.innerHTML = `
              <div class="country-card h-100">
                <img src="${pais.flags.png}" class="country-flag">
                <div class="country-info">
                  <div class="country-name">${pais.name.common}</div>
                  <div class="country-detail"><strong>Capital:</strong> ${pais.capital?.[0] || 'No disponible'}</div>
                  <div class="country-detail"><strong>Población:</strong> ${pais.population.toLocaleString()}</div>
                  <div class="country-detail"><strong>Idiomas:</strong> ${Object.values(pais.languages || {}).join(', ')}</div>
                </div>
              </div>
            `;

            resultado.appendChild(div);
          });
        })
        .catch(err => {
          resultado.innerHTML =
            `<p class="text-danger fw-bold">Error: ${err.message}</p>`;
        });
    }




    /* 
       FUNCIÓN PRINCIPAL:
       Muestra país + mapa + países vecinos
        */
    async function mostrarPaisYLimitrofes(country) {

      const resultado = document.getElementById('resultado');
      resultado.innerHTML = ''; // Limpio pantalla


      /* 
         PANEL IZQUIERDO: Info del país y mapa
          */
      const panelPais = document.createElement('div');
      panelPais.classList.add('col-12', 'col-lg-6');

      // Card con datos
      panelPais.innerHTML = `
        <div class="card p-4 shadow border-0 text-start h-100">
          <h4 class="text-primary">${country.name.common}</h4>
          <p><strong>Capital:</strong> ${country.capital?.[0] || 'No disponible'}</p>
          <p><strong>Región:</strong> ${country.region}</p>
          <p><strong>Población:</strong> ${country.population.toLocaleString()}</p>
          <p><strong>Idiomas:</strong> ${Object.values(country.languages || {}).join(', ')}</p>
          <img src="${country.flags.png}" class="border rounded mb-2" width="150">
          <div id="map" style="height: 300px; border-radius: 8px;"></div>
        </div>
      `;

      resultado.appendChild(panelPais);



      /* 
         OBTENGO LATITUD Y LONGITUD
          */
      const [lat, lon] = country.latlng;



      /* 
         FIX PARA EVITAR MAPAS ROTOS
         Cuando se hace otra búsqueda, el mapa anterior 
         debe ser destruido, si no  explota Leaflet.
          */
      if (L.DomUtil.get('map') != null) {
        L.DomUtil.get('map')._leaflet_id = null;
      }



      /* 
         CREO EL MAPA CON LEAFLET
          */
      const map = L.map('map').setView([lat, lon], 5);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
        .addTo(map);

      L.marker([lat, lon])
        .addTo(map)
        .bindPopup(`<b>${country.name.common}</b><br>Capital: ${country.capital?.[0]}`)
        .openPopup();



      /* 
         PANEL DERECHO: Países Limítrofes
          */
      const panelLimitrofes = document.createElement('div');
      panelLimitrofes.classList.add('col-12', 'col-lg-6');

      panelLimitrofes.innerHTML = `
        <div class="card p-4 shadow border-0 text-start h-100">
          <h5 class="text-success">Países limítrofes</h5>
        </div>
      `;

      resultado.appendChild(panelLimitrofes);

      const contenedorLimitrofes = panelLimitrofes.querySelector('.card');



      /* 
         SI NO TIENE BORDERS tira el mensaje
          */
      if (!country.borders || country.borders.length === 0) {
        contenedorLimitrofes.innerHTML += `<p>No tiene países limítrofes.</p>`;
        return;
      }



      /* 
         TRAER INFORMACIÓN DE LOS VECINOS
          */
      const codes = country.borders.join(',');

      try {
        const res = await fetch(`https://restcountries.com/v3.1/alpha?codes=${codes}`);
        const vecinos = await res.json();

        // Recorro vecinos
        vecinos.forEach(p => {
          contenedorLimitrofes.innerHTML += `
            <div class="border-bottom pb-2 mb-2">
              <h6 class="text-secondary">${p.name.common}</h6>
              <p><strong>Capital:</strong> ${p.capital?.[0] || 'No disponible'}</p>
              <p><strong>Población:</strong> ${p.population.toLocaleString()}</p>
              <img src="${p.flags.png}" width="80" class="border rounded">
            </div>
          `;
        });

      } catch {
        contenedorLimitrofes.innerHTML += `<p>Error al cargar países limítrofes.</p>`;
      }
    }



    /* 
       ACTIVAR BUSCAR CON ENTER
        */
    document.getElementById('paisInput')
      .addEventListener('keydown', e => {
        if (e.key === 'Enter') buscarPais();
      });
/* licencias
Bootstrap 5.3.3=https://getbootstrap.com
CDN usado: jsDelivr
Licencia: MIT License

Leaflet 1.7.1
CDN usado: Unpkg CDN
Licencia: BSD-2 Clause
Autor: Vladimir Agafonkin

REST Countries API (v3.1)
Sitio oficial: https://restcountries.com
API usada
https://restcountries.com/v3.1/name/{pais}
https://restcountries.com/v3.1/region/{region}
https://restcountries.com/v3.1/alpha?codes={codigos}
Licencia: MIT License
Autor original: Apilayer

OpenStreetMap (para los mapas)
Sitio oficial: https://www.openstreetmap.org
Servidor de tiles usado: https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png
Licencia de los mapas:
ODbL 1.0 (Open Database License)
Autor: OpenStreetMap Contributors

HTLM, RESPONSIVE
Sitio oficial: https://plataformas-moviles.tecnica4berazategui.edu.ar/
autor:José Yedro

java script
sitio oficial:https://developer.mozilla.org/es/docs/Web/JavaScript
autor: Mozilla Developer Network
*/
  </script>
</body>
</html>
